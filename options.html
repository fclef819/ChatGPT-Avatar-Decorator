<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ChatGPT Avatar Decorator Options</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <main class="page">
      <h1>ChatGPT Avatar Decorator</h1>
      <div id="toast" class="toast" aria-live="polite"></div>

      <section class="card">
        <h2>全体設定</h2>
        <div class="field">
          <label for="globalName">表示名</label>
          <input id="globalName" type="text" placeholder="例: サポートAI" />
        </div>
        <div class="field">
          <label for="globalMode">画像モード</label>
          <select id="globalMode">
            <option value="random">ランダム</option>
            <option value="sentiment">ポジネガ順(1=ネガ,5=ポジ)</option>
          </select>
        </div>
        <div class="field">
          <label>画像(最大5枚)</label>
          <label class="inline-check">
            <input id="globalAvatarCrop" type="checkbox" checked />
            手動トリミング（正方形固定・円ガイド）
          </label>
          <div class="image-grid" id="globalImages"></div>
          <p class="hint sentiment-hint" id="globalSentimentHint">
            画像スロット1→5の順で、ネガティブ→ポジティブに配置してください。
          </p>
          <p class="hint">アップロード時にWebP変換し、長辺を自動縮小します。</p>
        </div>
        <div class="field">
          <label>背景画像</label>
          <div class="bg-row">
            <div class="bg-preview is-empty" id="globalBgPreview"></div>
            <div class="bg-controls">
              <input id="globalBgInput" type="file" accept="image/*" />
              <button id="globalBgClear" type="button">クリア</button>
            </div>
          </div>
          <p class="hint">画面サイズに合わせて自動調整されます。</p>
        </div>
        <div class="field">
          <label for="globalBgOverlay">背景画像の黒がけ(%)</label>
          <input id="globalBgOverlay" type="number" min="0" max="100" step="1" placeholder="0-100" />
          <p class="hint">0で黒がけなし、100で最も暗くなります。</p>
        </div>
        <div class="field">
          <label for="globalNameColor">アバター名テキスト色</label>
          <div class="color-input-row">
            <input id="globalNameColor" type="text" placeholder="#ffffff / rgba(255,255,255,0.9)" />
            <input id="globalNameColorPicker" type="color" value="#ffffff" />
          </div>
          <p class="hint">未入力なら既定色を使います。</p>
        </div>
        <div class="field">
          <label>チャット枠カラー</label>
          <div class="color-grid">
            <div class="color-field">
              <label for="globalAssistantBg">AI 背景色</label>
              <div class="color-input-row">
                <input
                  id="globalAssistantBg"
                  type="text"
                  placeholder="#ffffff / rgba(0,0,0,0.8)"
                />
                <input id="globalAssistantBgPicker" type="color" value="#ffffff" />
              </div>
            </div>
            <div class="color-field">
              <label for="globalAssistantBgOpacity">AI 背景透過度(%)</label>
              <input id="globalAssistantBgOpacity" type="number" min="0" max="100" step="1" />
            </div>
            <div class="color-field">
              <label for="globalAssistantText">AI テキスト色</label>
              <div class="color-input-row">
                <input
                  id="globalAssistantText"
                  type="text"
                  placeholder="#111111 / rgba(0,0,0,0.9)"
                />
                <input id="globalAssistantTextPicker" type="color" value="#111111" />
              </div>
            </div>
            <div class="color-field">
              <label for="globalUserBg">ユーザー背景色</label>
              <div class="color-input-row">
                <input id="globalUserBg" type="text" placeholder="#f5f5f5 / rgba(0,0,0,0.06)" />
                <input id="globalUserBgPicker" type="color" value="#f5f5f5" />
              </div>
            </div>
            <div class="color-field">
              <label for="globalUserBgOpacity">ユーザー背景透過度(%)</label>
              <input id="globalUserBgOpacity" type="number" min="0" max="100" step="1" />
            </div>
            <div class="color-field">
              <label for="globalUserText">ユーザーテキスト色</label>
              <div class="color-input-row">
                <input id="globalUserText" type="text" placeholder="#111111 / rgba(0,0,0,0.9)" />
                <input id="globalUserTextPicker" type="color" value="#111111" />
              </div>
            </div>
          </div>
          <p class="hint">未入力ならChatGPTの既定色を使います。</p>
        </div>
        <div class="size-preview-row">
          <div class="size-panel">
            <div class="field field-compact">
              <label for="globalAvatarSize">画像サイズ(px)</label>
              <input id="globalAvatarSize" type="number" min="16" max="96" step="1" />
            </div>
            <div class="field field-compact">
              <label for="globalNameSize">名前サイズ(px)</label>
              <input id="globalNameSize" type="number" min="10" max="32" step="1" />
            </div>
          </div>
          <div class="preview-panel">
            <label class="preview-label">プレビュー</label>
            <div class="preview message-preview" id="globalPreview">
              <div class="preview-header">
                <div class="preview-avatar"></div>
                <div class="preview-name"></div>
              </div>
              <div class="preview-bubble assistant">
                <div class="preview-text">AIメッセージのテキスト</div>
              </div>
              <div class="preview-bubble user">
                <div class="preview-text">ユーザーメッセージのテキスト</div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button id="saveGlobal">全体設定を保存</button>
        </div>
      </section>

      <section class="card">
        <h2>プロジェクト別設定</h2>
        <p class="hint">
          ChatGPTのURLが <code>/projects/&lt;projectId&gt;</code> または
          <code>/g/&lt;projectId&gt;/c/&lt;chatId&gt;</code> 形式の場合、その
          <code>projectId</code> を入力してください。
        </p>
        <div class="field">
          <label for="projectId">projectId</label>
          <input id="projectId" type="text" placeholder="例: 8f2c9c..." />
          <div class="field field-child">
            <label for="projectUrl">URLから抽出（補助）</label>
            <div class="inline-row">
              <input id="projectUrl" type="text" placeholder="https://chatgpt.com/g/..." />
              <button id="extractProjectId" type="button">抽出</button>
            </div>
          </div>
        </div>
        <div class="field">
          <label for="projectName">表示名</label>
          <input id="projectName" type="text" placeholder="例: プロジェクト専用AI" />
        </div>
        <div class="field">
          <label for="projectMode">画像モード</label>
          <select id="projectMode">
            <option value="random">ランダム</option>
            <option value="sentiment">ポジネガ順(1=ネガ,5=ポジ)</option>
          </select>
        </div>
        <div class="field">
          <label>画像(最大5枚)</label>
          <label class="inline-check">
            <input id="projectAvatarCrop" type="checkbox" checked />
            手動トリミング（正方形固定・円ガイド）
          </label>
          <div class="image-grid" id="projectImages"></div>
          <p class="hint sentiment-hint" id="projectSentimentHint">
            画像スロット1→5の順で、ネガティブ→ポジティブに配置してください。
          </p>
          <p class="hint">アップロード時にWebP変換し、長辺を自動縮小します。</p>
        </div>
        <div class="field">
          <label>背景画像</label>
          <div class="bg-row">
            <div class="bg-preview is-empty" id="projectBgPreview"></div>
            <div class="bg-controls">
              <input id="projectBgInput" type="file" accept="image/*" />
              <button id="projectBgClear" type="button">クリア</button>
            </div>
          </div>
          <p class="hint">画面サイズに合わせて自動調整されます。</p>
        </div>
        <div class="field">
          <label for="projectBgOverlay">背景画像の黒がけ(%)</label>
          <input
            id="projectBgOverlay"
            type="number"
            min="0"
            max="100"
            step="1"
            placeholder="0-100"
          />
          <p class="hint">0で黒がけなし、100で最も暗くなります。</p>
        </div>
        <div class="field">
          <label for="projectNameColor">アバター名テキスト色</label>
          <div class="color-input-row">
            <input
              id="projectNameColor"
              type="text"
              placeholder="#ffffff / rgba(255,255,255,0.9)"
            />
            <input id="projectNameColorPicker" type="color" value="#ffffff" />
          </div>
          <p class="hint">未入力なら既定色を使います。</p>
        </div>
        <div class="field">
          <label>チャット枠カラー</label>
          <div class="color-grid">
            <div class="color-field">
              <label for="projectAssistantBg">AI 背景色</label>
              <div class="color-input-row">
                <input
                  id="projectAssistantBg"
                  type="text"
                  placeholder="#ffffff / rgba(0,0,0,0.8)"
                />
                <input id="projectAssistantBgPicker" type="color" value="#ffffff" />
              </div>
            </div>
            <div class="color-field">
              <label for="projectAssistantBgOpacity">AI 背景透過度(%)</label>
              <input id="projectAssistantBgOpacity" type="number" min="0" max="100" step="1" />
            </div>
            <div class="color-field">
              <label for="projectAssistantText">AI テキスト色</label>
              <div class="color-input-row">
                <input
                  id="projectAssistantText"
                  type="text"
                  placeholder="#111111 / rgba(0,0,0,0.9)"
                />
                <input id="projectAssistantTextPicker" type="color" value="#111111" />
              </div>
            </div>
            <div class="color-field">
              <label for="projectUserBg">ユーザー背景色</label>
              <div class="color-input-row">
                <input id="projectUserBg" type="text" placeholder="#f5f5f5 / rgba(0,0,0,0.06)" />
                <input id="projectUserBgPicker" type="color" value="#f5f5f5" />
              </div>
            </div>
            <div class="color-field">
              <label for="projectUserBgOpacity">ユーザー背景透過度(%)</label>
              <input id="projectUserBgOpacity" type="number" min="0" max="100" step="1" />
            </div>
            <div class="color-field">
              <label for="projectUserText">ユーザーテキスト色</label>
              <div class="color-input-row">
                <input id="projectUserText" type="text" placeholder="#111111 / rgba(0,0,0,0.9)" />
                <input id="projectUserTextPicker" type="color" value="#111111" />
              </div>
            </div>
          </div>
          <p class="hint">未入力ならChatGPTの既定色を使います。</p>
        </div>
        <div class="size-preview-row">
          <div class="size-panel">
            <div class="field field-compact">
              <label for="projectAvatarSize">画像サイズ(px)</label>
              <input id="projectAvatarSize" type="number" min="16" max="96" step="1" />
            </div>
            <div class="field field-compact">
              <label for="projectNameSize">名前サイズ(px)</label>
              <input id="projectNameSize" type="number" min="10" max="32" step="1" />
            </div>
          </div>
          <div class="preview-panel">
            <label class="preview-label">プレビュー</label>
            <div class="preview message-preview" id="projectPreview">
              <div class="preview-header">
                <div class="preview-avatar"></div>
                <div class="preview-name"></div>
              </div>
              <div class="preview-bubble assistant">
                <div class="preview-text">AIメッセージのテキスト</div>
              </div>
              <div class="preview-bubble user">
                <div class="preview-text">ユーザーメッセージのテキスト</div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button id="saveProject">プロジェクト設定を保存/更新</button>
          <button id="clearProject">入力をクリア</button>
        </div>

        <div class="list" id="projectList"></div>
      </section>

      <section class="card">
        <h2>設定の入出力</h2>
        <div class="actions">
          <button id="exportSettings">設定をダウンロード</button>
          <label class="import-label" id="importLabel">
            <input id="importSettings" type="file" accept="application/json" />
            <span id="importLabelText">設定をアップロード</span>
            <span class="import-spinner" aria-hidden="true"></span>
          </label>
        </div>
        <p class="hint">JSONファイルでエクスポート/インポートできます。</p>
      </section>
    </main>

    <div id="avatarCropModal" class="crop-modal" aria-hidden="true">
      <div class="crop-dialog" role="dialog" aria-modal="true" aria-label="アバタートリミング">
        <h3>アバターをトリミング</h3>
        <p class="hint">画像をドラッグして位置調整、スライダーで拡大縮小できます。</p>
        <canvas id="avatarCropCanvas" class="crop-canvas" width="420" height="420"></canvas>
        <div class="field">
          <label for="avatarCropZoom">拡大率</label>
          <input id="avatarCropZoom" type="range" min="1" max="3" step="0.01" value="1" />
        </div>
        <div class="actions">
          <button id="avatarCropApply" type="button">適用</button>
          <button id="avatarCropCancel" type="button">キャンセル</button>
        </div>
      </div>
    </div>

    <script src="options.js"></script>
  </body>
</html>
